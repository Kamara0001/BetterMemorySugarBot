import requests
import responses
import datetime

from django.test import TestCase, override_settings

from ..data_processing import *
from ..models import InfusionChanged, SensorChanged


class DataProcessingTests(TestCase):

    @responses.activate
    def test_process_nighscout_response_empty(self):
        responses.add(responses.GET, 'https://benc.com/api/v1/treatments',
                      json={}, status=200)
        response = requests.get("https://benc.com/api/v1/treatments")
        processed = process_nightscouts_api_response(response)
        self.assertIsNone(processed[0])
        self.assertIsNone(processed[1])

    @responses.activate
    def test_process_nighscout_response(self):
        responses.add(responses.GET, 'https://benc.com/api/v1/treatments',
                      json=[{"_id": "5d361635a7775b341af642eb", "created_at": "2019-07-22T21:37:28+02:00",
                             "eventType": "BG Check", "glucose": 118, "glucoseType": "Finger", "key600": "BG816AFFDA",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642cd", "absolute": 1.3,
                             "created_at": "2019-07-22T20:14:57+02:00", "duration": 30, "eventType": "Temp Basal",
                             "key600": "BASAL816AEC83", "notes": "Temp Basal: 1.3U, duration 30 minutes", "carbs": None,
                             "insulin": None},
                            {"_id": "5d361634a7775b341af642b1", "carbs": 12, "created_at": "2019-07-22T20:03:13+02:00",
                             "eventType": "Meal Bolus", "insulin": 1, "key600": "BOLUS816AE9C3",
                             "notes": "carb 12g 1.0U, {75~100} 0.0U, iob 2.0 0.0U (12g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642b3", "carbs": 24, "created_at": "2019-07-22T19:18:33+02:00",
                             "eventType": "Meal Bolus", "insulin": 2, "key600": "BOLUS816ADF4B",
                             "notes": "carb 24g 2.0U, {75~100} 0.0U, iob 1.3 0.0U (12g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642ed", "created_at": "2019-07-22T18:30:12+02:00",
                             "eventType": "BG Check", "glucose": 144, "glucoseType": "Finger", "key600": "BG816AD3F6",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642b5", "created_at": "2019-07-22T18:15:25+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.5, "key600": "BOLUS816AD07F",
                             "notes": "carb 0g 0.0U, {75~100} 0.5U, iob 3.3 -0.5U (12g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d361635a7775b341af642ef", "created_at": "2019-07-22T18:14:47+02:00",
                             "eventType": "BG Check", "glucose": 158, "glucoseType": "Finger", "key600": "BG816AD059",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642b7", "carbs": 30, "created_at": "2019-07-22T17:20:58+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.5, "key600": "BOLUS816AC3BC",
                             "notes": "carb 30g 2.5U, {75~100} 0.0U, iob 2.8 0.0U (12g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642cf", "absolute": 3.3,
                             "created_at": "2019-07-22T17:20:46+02:00", "duration": 15, "eventType": "Temp Basal",
                             "key600": "BASAL816AC3B0",
                             "notes": "Temp Basal: 3.3U, duration 30 minutes * canceled, duration 15 minutes",
                             "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642b9", "carbs": 21, "created_at": "2019-07-22T16:58:19+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.125, "key600": "BOLUS816ABE6D",
                             "notes": "carb 21g 2.1U, {75~100} 0.0U, iob 1.0 0.0U (10g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642bb", "carbs": 8, "created_at": "2019-07-22T16:43:52+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.8, "key600": "BOLUS816ABB0A",
                             "notes": "carb 8g 0.8U, {75~100} 0.0U, iob 0.3 0.0U (10g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642d1", "absolute": 3.3,
                             "created_at": "2019-07-22T16:30:29+02:00", "duration": 30, "eventType": "Temp Basal",
                             "key600": "BASAL816AB7E7", "notes": "Temp Basal: 3.3U, duration 30 minutes", "carbs": None,
                             "insulin": None},
                            {"_id": "5d361635a7775b341af642d3", "created_at": "2019-07-22T16:30:14+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816AB7D8",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642d5", "absolute": 0,
                             "created_at": "2019-07-22T15:36:43+02:00", "duration": 53, "eventType": "Temp Basal",
                             "key600": "SUSPEND816AAB4C", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642bd", "carbs": 7, "created_at": "2019-07-22T15:15:02+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.7, "key600": "BOLUS816AA637",
                             "notes": "carb 7g 0.7U, {75~100} 0.0U, iob 1.5 0.0U (10g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642d7", "created_at": "2019-07-22T15:03:14+02:00",
                             "duration": 22, "eventType": "Temp Basal", "key600": "BASAL816AA373",
                             "notes": "Temp Basal: 200%, duration 30 minutes * canceled, duration 22 minutes",
                             "percent": 100, "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642d9", "created_at": "2019-07-22T14:45:49+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816A9F5E",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642db", "absolute": 0,
                             "created_at": "2019-07-22T14:36:59+02:00", "duration": 8, "eventType": "Temp Basal",
                             "key600": "SUSPEND816A9D4C", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None}, {"_id": "5d361635a7775b341af642dd", "absolute": 3.3,
                                                               "created_at": "2019-07-22T13:31:35+02:00",
                                                               "duration": 30, "eventType": "Temp Basal",
                                                               "key600": "BASAL816A8DF8",
                                                               "notes": "Temp Basal: 3.3U, duration 30 minutes",
                                                               "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642bf", "carbs": 10, "created_at": "2019-07-22T13:24:27+02:00",
                             "eventType": "Meal Bolus", "insulin": 1, "key600": "BOLUS816A8C4C",
                             "notes": "carb 10g 1.0U, {75~100} 0.0U, iob 6.0 0.0U (10g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642c1", "carbs": 45, "created_at": "2019-07-22T13:22:12+02:00",
                             "eventType": "Meal Bolus", "insulin": 4.575, "key600": "BOLUS816A8BC5",
                             "notes": "carb 45g 4.6U, {75~100} 0.0U, iob 1.5 0.0U (10g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642f1", "created_at": "2019-07-22T12:56:15+02:00",
                             "eventType": "BG Check", "glucose": 130, "glucoseType": "Finger", "key600": "BG816A85B0",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642c3", "carbs": 20, "created_at": "2019-07-22T11:48:30+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.175, "key600": "BOLUS816A75CF",
                             "notes": "carb 20g 2.2U, {75~100} 0.0U, iob 2.8 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642c5", "created_at": "2019-07-22T11:27:48+02:00",
                             "eventType": "Meal Bolus", "insulin": 1, "key600": "BOLUS816A70F5",
                             "notes": "carb 0g 0.0U, {75~100} 0.9U, iob 2.2 -0.9U (9g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d361635a7775b341af642f3", "created_at": "2019-07-22T11:27:47+02:00",
                             "eventType": "BG Check", "glucose": 212, "glucoseType": "Finger", "key600": "BG816A70F4",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642c7", "carbs": 22, "created_at": "2019-07-22T10:58:44+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.4, "key600": "BOLUS816A6A25",
                             "notes": "carb 22g 2.4U, {75~100} 0.0U, iob 0.5 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642df", "absolute": 3.3,
                             "created_at": "2019-07-22T10:45:33+02:00", "duration": 30, "eventType": "Temp Basal",
                             "key600": "BASAL816A670E", "notes": "Temp Basal: 3.3U, duration 30 minutes", "carbs": None,
                             "insulin": None},
                            {"_id": "5d361635a7775b341af642e1", "created_at": "2019-07-22T10:43:37+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816A669A",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642e3", "absolute": 0,
                             "created_at": "2019-07-22T09:16:34+02:00", "duration": 87, "eventType": "Temp Basal",
                             "key600": "SUSPEND816A5232", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642e5", "created_at": "2019-07-22T08:48:53+02:00",
                             "duration": 4, "eventType": "Temp Basal", "key600": "BASAL816A4BB5",
                             "notes": "Temp Basal: 200%, duration 30 minutes * canceled, duration 4 minutes",
                             "percent": 100, "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642c9", "carbs": 12, "created_at": "2019-07-22T08:33:35+02:00",
                             "eventType": "Meal Bolus", "insulin": 1.3, "key600": "BOLUS816A481F",
                             "notes": "carb 12g 1.3U, {75~100} 0.0U, iob 3.7 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642cb", "carbs": 35, "created_at": "2019-07-22T08:15:27+02:00",
                             "eventType": "Meal Bolus", "insulin": 3.825, "key600": "BOLUS816A43DF",
                             "notes": "carb 35g 3.8U, {75~100} 0.0U, iob 0.0 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d361635a7775b341af642e7", "created_at": "2019-07-22T07:22:42+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816A3782",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642e9", "absolute": 0,
                             "created_at": "2019-07-22T06:40:57+02:00", "duration": 41, "eventType": "Temp Basal",
                             "key600": "SUSPEND816A2DB9", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None},
                            {"_id": "5d361635a7775b341af642f5", "created_at": "2019-07-22T06:40:29+02:00",
                             "eventType": "BG Check", "glucose": 134, "glucoseType": "Finger", "key600": "BG816A2D9D",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d350baba7775b341af0fcf1", "created_at": "2019-07-22T03:01:49+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.2, "key600": "BOLUS8169FA60",
                             "notes": "carb 0g 0.0U, {75~100} 0.5U, iob 0.0 0.0U (10g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d361635a7775b341af642f7", "created_at": "2019-07-22T02:58:35+02:00",
                             "eventType": "BG Check", "glucose": 160, "glucoseType": "Finger", "key600": "BG8169F99E",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34eb69a7775b341af0907c", "created_at": "2019-07-22T00:43:09+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME8169D9E0",
                             "notes": "Pump resumed insulin delivery: Low glucose auto resume - max suspend period",
                             "carbs": None, "insulin": None},
                            {"_id": "5d34eb69a7775b341af09080", "created_at": "2019-07-21T23:31:59+02:00",
                             "eventType": "BG Check", "glucose": 84, "glucoseType": "Finger", "key600": "BG8169C933",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34d4f9a7775b341af01584", "created_at": "2019-07-21T23:08:56+02:00",
                             "eventType": "BG Check", "glucose": 88, "glucoseType": "Finger", "key600": "BG8169C3CC",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34d4f9a7775b341af01586", "created_at": "2019-07-21T22:50:08+02:00",
                             "eventType": "BG Check", "glucose": 91, "glucoseType": "Finger", "key600": "BG8169BF64",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34eb69a7775b341af0907e", "absolute": 0,
                             "created_at": "2019-07-21T22:43:03+02:00", "duration": 120, "eventType": "Temp Basal",
                             "key600": "SUSPEND8169BDBB",
                             "notes": "Pump suspended insulin delivery: Predicted low glucose suspend", "carbs": None,
                             "insulin": None},
                            {"_id": "5d34cf3fa7775b341aefee51", "created_at": "2019-07-21T22:26:06+02:00",
                             "eventType": "BG Check", "glucose": 89, "glucoseType": "Finger", "key600": "BG8169B9C1",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34ca9fa7775b341aefcfdf", "created_at": "2019-07-21T22:09:04+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME8169B5C3",
                             "notes": "Pump resumed insulin delivery: Low glucose manual resume", "carbs": None,
                             "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b9c", "created_at": "2019-07-21T21:39:02+02:00",
                             "eventType": "BG Check", "glucose": 81, "glucoseType": "Finger", "key600": "BG8169AEB9",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34ca9fa7775b341aefcfe1", "absolute": 0,
                             "created_at": "2019-07-21T21:27:58+02:00", "duration": 41, "eventType": "Temp Basal",
                             "key600": "SUSPEND8169AC21",
                             "notes": "Pump suspended insulin delivery: Predicted low glucose suspend", "carbs": None,
                             "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b9e", "created_at": "2019-07-21T20:59:49+02:00",
                             "eventType": "BG Check", "glucose": 95, "glucoseType": "Finger", "key600": "BG8169A588",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8ba0", "created_at": "2019-07-21T20:39:24+02:00",
                             "eventType": "BG Check", "glucose": 133, "glucoseType": "Finger", "key600": "BG8169A0BF",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b7e", "created_at": "2019-07-21T20:32:24+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME81699F1B",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8bb8", "created_at": "2019-07-21T20:30:40+02:00",
                             "eventType": "Site Change", "key600": "MISC81699EB3", "notes": "Reservoir changed",
                             "carbs": None, "insulin": None}, {"_id": "5d34c068a7775b341aef8b80", "absolute": 0,
                                                               "created_at": "2019-07-21T20:30:01+02:00", "duration": 2,
                                                               "eventType": "Temp Basal", "key600": "SUSPEND81699E8C",
                                                               "notes": "Pump suspended insulin delivery: Set change suspend",
                                                               "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b6a", "carbs": 24, "created_at": "2019-07-21T19:26:14+02:00",
                             "eventType": "Meal Bolus", "insulin": 2, "key600": "BOLUS81698F99",
                             "notes": "carb 24g 2.0U, {75~100} 0.9U, iob 5.2 -0.9U (12g/u, isf 125/u)"},
                            {"_id": "5d34c068a7775b341aef8ba2", "created_at": "2019-07-21T19:25:39+02:00",
                             "eventType": "BG Check", "glucose": 207, "glucoseType": "Finger", "key600": "BG81698F76",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b6c", "carbs": 50, "created_at": "2019-07-21T19:11:18+02:00",
                             "eventType": "Meal Bolus", "insulin": 4.15, "key600": "BOLUS81698C19",
                             "notes": "carb 50g 4.2U, {75~100} 1.0U, iob 1.5 -1.0U (12g/u, isf 125/u)"},
                            {"_id": "5d34c068a7775b341aef8ba4", "created_at": "2019-07-21T19:05:29+02:00",
                             "eventType": "BG Check", "glucose": 226, "glucoseType": "Finger", "key600": "BG81698ABC",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8bba", "created_at": "2019-07-21T18:58:52+02:00",
                             "eventType": "Sensor Start", "key600": "MISC8169892F", "notes": "Sensor changed",
                             "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b6e", "created_at": "2019-07-21T18:16:30+02:00",
                             "eventType": "Meal Bolus", "insulin": 2, "key600": "BOLUS81697F41",
                             "notes": "carb 0g 0.0U, {75~100} 1.7U, iob 0.0 0.0U (12g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d34c068a7775b341aef8b82", "created_at": "2019-07-21T18:13:31+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME81697E8E",
                             "notes": "Pump resumed insulin delivery: Low glucose manual resume", "carbs": None,
                             "insulin": None},
                            {"_id": "5d34c068a7775b341aef8ba6", "created_at": "2019-07-21T18:12:38+02:00",
                             "eventType": "BG Check", "glucose": 309, "glucoseType": "Finger", "key600": "BG81697E59",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b84", "absolute": 0,
                             "created_at": "2019-07-21T17:46:41+02:00", "duration": 26, "eventType": "Temp Basal",
                             "key600": "SUSPEND81697844",
                             "notes": "Pump suspended insulin delivery: Predicted low glucose suspend", "carbs": None,
                             "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b86", "created_at": "2019-07-21T17:23:32+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816972D7",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b88", "absolute": 0,
                             "created_at": "2019-07-21T16:24:56+02:00", "duration": 58, "eventType": "Temp Basal",
                             "key600": "SUSPEND8169651B", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None}, {"_id": "5d34c068a7775b341aef8b8a", "absolute": 3.3,
                                                               "created_at": "2019-07-21T15:51:07+02:00",
                                                               "duration": 30, "eventType": "Temp Basal",
                                                               "key600": "BASAL81695D2E",
                                                               "notes": "Temp Basal: 3.3U, duration 30 minutes",
                                                               "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b70", "created_at": "2019-07-21T15:21:05+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.875, "key600": "BOLUS81695623",
                             "notes": "carb 0g 0.0U, {75~100} 0.9U, iob 0.9 -0.9U (10g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d34c068a7775b341aef8b8c", "absolute": 3.3,
                             "created_at": "2019-07-21T15:20:35+02:00", "duration": 10, "eventType": "Temp Basal",
                             "key600": "BASAL81695605",
                             "notes": "Temp Basal: 3.3U, duration 30 minutes * canceled, duration 10 minutes",
                             "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8ba8", "created_at": "2019-07-21T15:15:00+02:00",
                             "eventType": "BG Check", "glucose": 210, "glucoseType": "Finger", "key600": "BG816954B6",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b8e", "created_at": "2019-07-21T14:56:51+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME81695075",
                             "notes": "Pump resumed insulin delivery: Low glucose auto resume - preset glucose reached",
                             "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8baa", "created_at": "2019-07-21T14:22:43+02:00",
                             "eventType": "BG Check", "glucose": 125, "glucoseType": "Finger", "key600": "BG81694875",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b90", "absolute": 0,
                             "created_at": "2019-07-21T14:21:50+02:00", "duration": 35, "eventType": "Temp Basal",
                             "key600": "SUSPEND81694840",
                             "notes": "Pump suspended insulin delivery: Predicted low glucose suspend", "carbs": None,
                             "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b72", "carbs": 24, "created_at": "2019-07-21T13:35:06+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.425, "key600": "BOLUS81693D4C",
                             "notes": "carb 24g 2.4U, {75~100} 0.3U, iob 2.3 -0.3U (10g/u, isf 125/u)"},
                            {"_id": "5d34c068a7775b341aef8bac", "created_at": "2019-07-21T13:34:43+02:00",
                             "eventType": "BG Check", "glucose": 141, "glucoseType": "Finger", "key600": "BG81693D35",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8bae", "created_at": "2019-07-21T13:22:37+02:00",
                             "eventType": "BG Check", "glucose": 148, "glucoseType": "Finger", "key600": "BG81693A5F",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8bb0", "created_at": "2019-07-21T12:46:23+02:00",
                             "eventType": "BG Check", "glucose": 251, "glucoseType": "Finger", "key600": "BG816931E1",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8bb2", "created_at": "2019-07-21T12:20:13+02:00",
                             "eventType": "BG Check", "glucose": 297, "glucoseType": "Finger", "key600": "BG81692BBF",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b74", "carbs": 20, "created_at": "2019-07-21T12:10:02+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.175, "key600": "BOLUS8169295C",
                             "notes": "carb 20g 2.2U, {75~100} 0.0U, iob 4.5 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d34c068a7775b341aef8b76", "carbs": 25, "created_at": "2019-07-21T11:53:32+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.725, "key600": "BOLUS8169257E",
                             "notes": "carb 25g 2.7U, {75~100} 0.0U, iob 2.2 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d34c068a7775b341aef8b92", "absolute": 3.3,
                             "created_at": "2019-07-21T11:53:13+02:00", "duration": 30, "eventType": "Temp Basal",
                             "key600": "BASAL8169256B", "notes": "Temp Basal: 3.3U, duration 30 minutes", "carbs": None,
                             "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b78", "created_at": "2019-07-21T11:20:15+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.5, "key600": "BOLUS81691DB1",
                             "notes": "carb 0g 0.0U, {75~100} 1.7U, iob 0.0 0.0U (9g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d34c068a7775b341aef8bb4", "created_at": "2019-07-21T11:19:19+02:00",
                             "eventType": "BG Check", "glucose": 309, "glucoseType": "Finger", "key600": "BG81691D79",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b94", "created_at": "2019-07-21T10:46:00+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816915AA",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b96", "absolute": 0,
                             "created_at": "2019-07-21T09:06:11+02:00", "duration": 99, "eventType": "Temp Basal",
                             "key600": "SUSPEND8168FE44", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b98", "created_at": "2019-07-21T08:27:11+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME8168F520",
                             "notes": "Pump resumed insulin delivery: Low glucose manual resume", "carbs": None,
                             "insulin": None}, {"_id": "5d34c068a7775b341aef8b9a", "absolute": 0,
                                                "created_at": "2019-07-21T08:06:50+02:00", "duration": 20,
                                                "eventType": "Temp Basal", "key600": "SUSPEND8168F05B",
                                                "notes": "Pump suspended insulin delivery: Predicted low glucose suspend",
                                                "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8b7a", "carbs": 25, "created_at": "2019-07-21T07:59:27+02:00",
                             "eventType": "Meal Bolus", "insulin": 4.075, "key600": "BOLUS8168EEA0",
                             "notes": "carb 25g 4.1U, {75~100} 0.0U, iob 0.2 0.0U (6g/u, isf 125/u)"},
                            {"_id": "5d33e78aa7775b341ae92c56", "created_at": "2019-07-21T06:18:04+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.4, "key600": "BOLUS8168D6DD",
                             "notes": "carb 0g 0.0U, {75~100} 0.4U, iob 0.0 0.0U (6g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d34c068a7775b341aef8bb6", "created_at": "2019-07-21T06:17:32+02:00",
                             "eventType": "BG Check", "glucose": 151, "glucoseType": "Finger", "key600": "BG8168D6BD",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d33853fa7775b341ae7572a", "created_at": "2019-07-20T23:17:31+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME8168744E",
                             "notes": "Pump resumed insulin delivery: Low glucose manual resume", "carbs": None,
                             "insulin": None}, {"_id": "5d33853fa7775b341ae7572c", "absolute": 0,
                                                "created_at": "2019-07-20T23:06:48+02:00", "duration": 10,
                                                "eventType": "Temp Basal", "key600": "SUSPEND816871CB",
                                                "notes": "Pump suspended insulin delivery: Predicted low glucose suspend",
                                                "carbs": None, "insulin": None},
                            {"_id": "5d3379e6a7775b341ae6e566", "absolute": 3.3,
                             "created_at": "2019-07-20T22:09:13+02:00", "duration": 20, "eventType": "Temp Basal",
                             "key600": "BASAL8168644C",
                             "notes": "Temp Basal: 3.3U, duration 30 minutes * canceled, duration 20 minutes",
                             "carbs": None, "insulin": None},
                            {"_id": "5d3374f0a7775b341ae6b696", "created_at": "2019-07-20T22:08:37+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.9, "key600": "BOLUS81686428",
                             "notes": "carb 0g 0.0U, {75~100} 0.8U, iob 0.0 0.0U (12g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d3374f0a7775b341ae6b698", "created_at": "2019-07-20T22:07:40+02:00",
                             "eventType": "BG Check", "glucose": 197, "glucoseType": "Finger", "key600": "BG816863EF",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d33725ca7775b341ae6a125", "created_at": "2019-07-20T21:32:08+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME81685B9B",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d33725ca7775b341ae6a127", "absolute": 0,
                             "created_at": "2019-07-20T20:28:31+02:00", "duration": 63, "eventType": "Temp Basal",
                             "key600": "SUSPEND81684CB2", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None}, {"_id": "5d33725ca7775b341ae6a129", "absolute": 3.3,
                                                               "created_at": "2019-07-20T19:27:10+02:00",
                                                               "duration": 30, "eventType": "Temp Basal",
                                                               "key600": "BASAL81683E51",
                                                               "notes": "Temp Basal: 3.3U, duration 30 minutes",
                                                               "carbs": None, "insulin": None},
                            {"_id": "5d334c66a7775b341ae5cb3e", "carbs": 55, "created_at": "2019-07-20T18:48:31+02:00",
                             "eventType": "Meal Bolus", "insulin": 4.575, "key600": "BOLUS81683542",
                             "notes": "carb 55g 4.6U, {75~100} 0.0U, iob 0.7 0.0U (12g/u, isf 125/u)"},
                            {"_id": "5d333948a7775b341ae583e1", "created_at": "2019-07-20T17:51:48+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.825, "key600": "BOLUS816827F7",
                             "notes": "carb 0g 0.0U, {75~100} 1.2U, iob 0.4 -0.4U (12g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d334c66a7775b341ae5cb40", "created_at": "2019-07-20T17:49:49+02:00",
                             "eventType": "BG Check", "glucose": 250, "glucoseType": "Finger", "key600": "BG81682780",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d333948a7775b341ae583e3", "absolute": 3.3,
                             "created_at": "2019-07-20T17:15:30+02:00", "duration": 30, "eventType": "Temp Basal",
                             "key600": "BASAL81681F75", "notes": "Temp Basal: 3.3U, duration 30 minutes", "carbs": None,
                             "insulin": None},
                            {"_id": "5d333257a7775b341ae56c68", "created_at": "2019-07-20T16:43:39+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.525, "key600": "BOLUS816817FE",
                             "notes": "carb 0g 0.0U, {75~100} 0.8U, iob 0.3 -0.3U (10g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d333257a7775b341ae56c8c", "created_at": "2019-07-20T16:43:38+02:00",
                             "eventType": "BG Check", "glucose": 204, "glucoseType": "Finger", "key600": "BG816817FD",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c7a", "created_at": "2019-07-20T16:43:05+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816817DC",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d34c068a7775b341aef8bbc", "created_at": "2019-07-20T16:41:30+02:00",
                             "eventType": "Site Change", "key600": "MISC8168177D", "notes": "Reservoir changed",
                             "carbs": None, "insulin": None}, {"_id": "5d333257a7775b341ae56c7c", "absolute": 0,
                                                               "created_at": "2019-07-20T16:40:57+02:00", "duration": 2,
                                                               "eventType": "Temp Basal", "key600": "SUSPEND8168175C",
                                                               "notes": "Pump suspended insulin delivery: Set change suspend",
                                                               "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c6a", "created_at": "2019-07-20T15:27:51+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.5, "key600": "BOLUS8168063A",
                             "notes": "carb 0g 0.0U, {75~100} 0.4U, iob 1.8 -0.4U (10g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d333257a7775b341ae56c8e", "created_at": "2019-07-20T15:27:49+02:00",
                             "eventType": "BG Check", "glucose": 155, "glucoseType": "Finger", "key600": "BG81680638",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c6c", "carbs": 20, "created_at": "2019-07-20T13:25:20+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.025, "key600": "BOLUS8167E983",
                             "notes": "carb 20g 2.0U, {75~100} 0.0U, iob 7.2 0.0U (10g/u, isf 125/u)"},
                            {"_id": "5d333257a7775b341ae56c6e", "carbs": 65, "created_at": "2019-07-20T13:16:10+02:00",
                             "eventType": "Meal Bolus", "insulin": 6.625, "key600": "BOLUS8167E75D",
                             "notes": "carb 65g 6.6U, {75~100} 0.0U, iob 0.7 0.0U (10g/u, isf 125/u)"},
                            {"_id": "5d333257a7775b341ae56c7e", "absolute": 3.3,
                             "created_at": "2019-07-20T12:57:54+02:00", "duration": 17, "eventType": "Temp Basal",
                             "key600": "BASAL8167E315",
                             "notes": "Temp Basal: 3.3U, duration 30 minutes * canceled, duration 17 minutes",
                             "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c70", "created_at": "2019-07-20T12:52:12+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.7, "key600": "BOLUS8167E1BF",
                             "notes": "carb 0g 0.0U, {75~100} 0.6U, iob 0.0 0.0U (9g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d333257a7775b341ae56c90", "created_at": "2019-07-20T12:52:11+02:00",
                             "eventType": "BG Check", "glucose": 176, "glucoseType": "Finger", "key600": "BG8167E1BE",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c80", "absolute": 3.3,
                             "created_at": "2019-07-20T12:12:19+02:00", "duration": 30, "eventType": "Temp Basal",
                             "key600": "BASAL8167D866", "notes": "Temp Basal: 3.3U, duration 30 minutes", "carbs": None,
                             "insulin": None},
                            {"_id": "5d333257a7775b341ae56c82", "created_at": "2019-07-20T12:02:34+02:00",
                             "duration": 9, "eventType": "Temp Basal", "key600": "BASAL8167D61D",
                             "notes": "Temp Basal: 200%, duration 30 minutes * canceled, duration 9 minutes",
                             "percent": 100, "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c84", "created_at": "2019-07-20T10:46:46+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME8167C458",
                             "notes": "Pump resumed insulin delivery: Low glucose auto resume - preset glucose reached",
                             "carbs": None, "insulin": None}, {"_id": "5d333257a7775b341ae56c86", "absolute": 0,
                                                               "created_at": "2019-07-20T10:11:55+02:00",
                                                               "duration": 34, "eventType": "Temp Basal",
                                                               "key600": "SUSPEND8167BC2D",
                                                               "notes": "Pump suspended insulin delivery: Predicted low glucose suspend",
                                                               "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c72", "carbs": 20, "created_at": "2019-07-20T08:33:11+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.175, "key600": "BOLUS8167A509",
                             "notes": "carb 20g 2.2U, {75~100} 0.0U, iob 1.7 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d333257a7775b341ae56c74", "carbs": 15, "created_at": "2019-07-20T08:06:45+02:00",
                             "eventType": "Meal Bolus", "insulin": 1.625, "key600": "BOLUS81679ED7",
                             "notes": "carb 15g 1.6U, {75~100} 0.0U, iob 0.2 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d333257a7775b341ae56c76", "created_at": "2019-07-20T07:51:56+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.2, "key600": "BOLUS81679B5E",
                             "notes": "carb 0g 0.0U, {75~100} 0.0U, iob 0.0 0.0U (6g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d333257a7775b341ae56c88", "created_at": "2019-07-20T07:45:16+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816799CE",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c8a", "absolute": 0,
                             "created_at": "2019-07-20T07:16:39+02:00", "duration": 28, "eventType": "Temp Basal",
                             "key600": "SUSPEND81679319", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None},
                            {"_id": "5d333257a7775b341ae56c92", "created_at": "2019-07-20T06:54:23+02:00",
                             "eventType": "BG Check", "glucose": 132, "glucoseType": "Finger", "key600": "BG81678DE1",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d323257a7775b341ae1ef02", "created_at": "2019-07-19T22:02:40+02:00",
                             "duration": 30, "eventType": "Temp Basal", "key600": "BASAL81671141",
                             "notes": "Temp Basal: 155%, duration 30 minutes", "percent": 55, "carbs": None,
                             "insulin": None},
                            {"_id": "5d323257a7775b341ae1ef00", "carbs": 10, "created_at": "2019-07-19T21:52:50+02:00",
                             "duration": 78, "enteredinsulin": "0.3", "eventType": "Combo Bolus",
                             "key600": "BOLUS81670EF4",
                             "notes": "Square Bolus: 0.825U, duration 210 minutes * ended before expected duration, square delivered 0.3U in 78 minutes : carb 10g 0.8U, {75~100} 0.0U, iob 0.2 0.0U (12g/u, isf 125/u)",
                             "relative": 2, "splitExt": "100", "splitNow": "0", "insulin": None},
                            {"_id": "5d3219dfa7775b341ae1a20d", "absolute": 2,
                             "created_at": "2019-07-19T21:02:20+02:00", "duration": 21, "eventType": "Temp Basal",
                             "key600": "BASAL8167031D",
                             "notes": "Temp Basal: 2.0U, duration 30 minutes * canceled, duration 21 minutes",
                             "carbs": None, "insulin": None},
                            {"_id": "5d3219dfa7775b341ae1a20b", "carbs": 22, "created_at": "2019-07-19T20:58:32+02:00",
                             "duration": 25, "enteredinsulin": "0.175", "eventType": "Combo Bolus",
                             "key600": "BOLUS81670239",
                             "notes": "Square Bolus: 1.825U, duration 255 minutes * ended before expected duration, square delivered 0.175U in 25 minutes : carb 22g 1.8U, {75~100} 0.0U, iob 0.8 0.0U (12g/u, isf 125/u)",
                             "relative": 2, "splitExt": "100", "splitNow": "0", "insulin": None},
                            {"_id": "5d321569a7775b341ae192cb", "carbs": 25, "created_at": "2019-07-19T20:58:04+02:00",
                             "duration": 0, "enteredinsulin": "0.0", "eventType": "Combo Bolus",
                             "key600": "BOLUS8167021D",
                             "notes": "Square Bolus: 2.075U, duration 30 minutes * ended before expected duration, square delivered 0.0U in 0 minutes : carb 25g 2.1U, {75~100} 0.0U, iob 0.9 0.0U (12g/u, isf 125/u)",
                             "relative": 2, "splitExt": "100", "splitNow": "0", "insulin": None},
                            {"_id": "5d321569a7775b341ae192df", "created_at": "2019-07-19T20:53:02+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816700EF",
                             "notes": "Pump resumed insulin delivery: Low glucose manual resume", "carbs": None,
                             "insulin": None}, {"_id": "5d321569a7775b341ae192e1", "absolute": 0,
                                                "created_at": "2019-07-19T20:36:43+02:00", "duration": 16,
                                                "eventType": "Temp Basal", "key600": "SUSPEND8166FD1C",
                                                "notes": "Pump suspended insulin delivery: Predicted low glucose suspend",
                                                "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192ff", "created_at": "2019-07-19T20:12:56+02:00",
                             "eventType": "BG Check", "glucose": 116, "glucoseType": "Finger", "key600": "BG8166F789",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae19301", "created_at": "2019-07-19T19:16:01+02:00",
                             "eventType": "BG Check", "glucose": 98, "glucoseType": "Finger", "key600": "BG8166EA32",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192cd", "carbs": 45, "created_at": "2019-07-19T18:45:30+02:00",
                             "eventType": "Meal Bolus", "insulin": 3.75, "key600": "BOLUS8166E30B",
                             "notes": "carb 45g 3.8U, {75~100} 0.0U, iob 4.2 0.0U (12g/u, isf 125/u)"},
                            {"_id": "5d321569a7775b341ae192cf", "carbs": 20, "created_at": "2019-07-19T18:16:11+02:00",
                             "eventType": "Meal Bolus", "insulin": 1.65, "key600": "BOLUS8166DC2C",
                             "notes": "carb 20g 1.7U, {75~100} 0.0U, iob 3.4 0.0U (12g/u, isf 125/u)"},
                            {"_id": "5d321569a7775b341ae192e3", "absolute": 3.3,
                             "created_at": "2019-07-19T18:15:57+02:00", "duration": 30, "eventType": "Temp Basal",
                             "key600": "BASAL8166DC1E", "notes": "Temp Basal: 3.3U, duration 30 minutes", "carbs": None,
                             "insulin": None},
                            {"_id": "5d321569a7775b341ae192d1", "carbs": 25, "created_at": "2019-07-19T17:57:41+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.075, "key600": "BOLUS8166D7D6",
                             "notes": "carb 25g 2.1U, {75~100} 0.0U, iob 1.6 0.0U (12g/u, isf 125/u)"},
                            {"_id": "5d321569a7775b341ae192d3", "carbs": 20, "created_at": "2019-07-19T17:39:24+02:00",
                             "eventType": "Meal Bolus", "insulin": 1.65, "key600": "BOLUS8166D38D",
                             "notes": "carb 20g 1.7U, {75~100} 0.0U, iob 0.0 0.0U (12g/u, isf 125/u)"},
                            {"_id": "5d321569a7775b341ae192e5", "created_at": "2019-07-19T17:25:32+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME8166D04D",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192e7", "absolute": 0,
                             "created_at": "2019-07-19T15:38:21+02:00", "duration": 107, "eventType": "Temp Basal",
                             "key600": "SUSPEND8166B72E", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192e9", "created_at": "2019-07-19T15:06:50+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME8166AFCA",
                             "notes": "Pump resumed insulin delivery: Low glucose auto resume - preset glucose reached",
                             "carbs": None, "insulin": None}, {"_id": "5d321569a7775b341ae192eb", "absolute": 0,
                                                               "created_at": "2019-07-19T14:11:54+02:00",
                                                               "duration": 54, "eventType": "Temp Basal",
                                                               "key600": "SUSPEND8166A2EA",
                                                               "notes": "Pump suspended insulin delivery: Predicted low glucose suspend",
                                                               "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192ed", "created_at": "2019-07-19T13:38:35+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME81669B1B",
                             "notes": "Pump resumed insulin delivery: Low glucose manual resume", "carbs": None,
                             "insulin": None}, {"_id": "5d321569a7775b341ae192ef", "absolute": 0,
                                                "created_at": "2019-07-19T13:16:51+02:00", "duration": 21,
                                                "eventType": "Temp Basal", "key600": "SUSPEND81669603",
                                                "notes": "Pump suspended insulin delivery: Predicted low glucose suspend",
                                                "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192d5", "carbs": 50, "created_at": "2019-07-19T12:13:54+02:00",
                             "eventType": "Meal Bolus", "insulin": 5.475, "key600": "BOLUS81668742",
                             "notes": "carb 50g 5.5U, {75~100} 0.0U, iob 2.6 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d321569a7775b341ae192f1", "created_at": "2019-07-19T11:34:09+02:00",
                             "duration": 30, "eventType": "Temp Basal", "key600": "BASAL81667DF1",
                             "notes": "Temp Basal: 200%, duration 30 minutes", "percent": 100, "carbs": None,
                             "insulin": None},
                            {"_id": "5d321569a7775b341ae192d7", "carbs": 25, "created_at": "2019-07-19T11:33:53+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.725, "key600": "BOLUS81667DE1",
                             "notes": "carb 25g 2.7U, {75~100} 0.0U, iob 0.5 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d321569a7775b341ae192d9", "created_at": "2019-07-19T11:08:33+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.55, "key600": "BOLUS816677F1",
                             "notes": "carb 0g 0.0U, {75~100} 0.6U, iob 0.2 -0.2U (9g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d321569a7775b341ae19303", "created_at": "2019-07-19T11:08:31+02:00",
                             "eventType": "BG Check", "glucose": 171, "glucoseType": "Finger", "key600": "BG816677EF",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192f3", "absolute": 3.3,
                             "created_at": "2019-07-19T11:01:28+02:00", "duration": 6, "eventType": "Temp Basal",
                             "key600": "BASAL81667648",
                             "notes": "Temp Basal: 3.3U, duration 30 minutes * canceled, duration 6 minutes",
                             "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192f5", "created_at": "2019-07-19T10:52:31+02:00",
                             "duration": 8, "eventType": "Temp Basal", "key600": "BASAL8166742F",
                             "notes": "Temp Basal: 200%, duration 30 minutes * canceled, duration 8 minutes",
                             "percent": 100, "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192f7", "created_at": "2019-07-19T10:37:38+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME816670B2",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192f9", "absolute": 0,
                             "created_at": "2019-07-19T08:38:45+02:00", "duration": 118, "eventType": "Temp Basal",
                             "key600": "SUSPEND816654D4", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192db", "carbs": 27, "created_at": "2019-07-19T08:20:16+02:00",
                             "eventType": "Meal Bolus", "insulin": 2.95, "key600": "BOLUS8166507F",
                             "notes": "carb 27g 3.0U, {75~100} 0.0U, iob 0.0 0.0U (9g/u, isf 125/u)"},
                            {"_id": "5d321569a7775b341ae19305", "created_at": "2019-07-19T07:55:46+02:00",
                             "eventType": "BG Check", "glucose": 106, "glucoseType": "Finger", "key600": "BG81664AC1",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192fb", "created_at": "2019-07-19T07:24:54+02:00",
                             "duration": 0, "eventType": "Temp Basal", "key600": "RESUME81664385",
                             "notes": "Pump resumed insulin delivery: User resumed", "carbs": None, "insulin": None},
                            {"_id": "5d321569a7775b341ae192fd", "absolute": 0,
                             "created_at": "2019-07-19T06:35:27+02:00", "duration": 49, "eventType": "Temp Basal",
                             "key600": "SUSPEND816637F2", "notes": "Pump suspended insulin delivery: User suspend",
                             "carbs": None, "insulin": None},
                            {"_id": "5d3109faa7775b341ade1a0b", "created_at": "2019-07-19T02:06:51+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.4, "key600": "BOLUS8165F8FE",
                             "notes": "carb 0g 0.0U, {75~100} 0.7U, iob 0.0 0.0U (10g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d3109faa7775b341ade1a0e", "created_at": "2019-07-19T02:06:50+02:00",
                             "eventType": "BG Check", "glucose": 190, "glucoseType": "Finger", "key600": "BG8165F8FD",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d30daf5a7775b341add8351", "created_at": "2019-07-18T22:44:51+02:00",
                             "eventType": "Meal Bolus", "insulin": 0.8, "key600": "BOLUS8165C9A6",
                             "notes": "carb 0g 0.0U, {75~100} 1.9U, iob 0.8 -0.8U (12g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d30da18a7775b341add8023", "created_at": "2019-07-18T22:39:40+02:00",
                             "eventType": "BG Check", "glucose": 335, "glucoseType": "Finger", "key600": "BG8165C86F",
                             "units": "mg/dl", "carbs": None, "insulin": None},
                            {"_id": "5d30d44ca7775b341add6d0a", "created_at": "2019-07-18T21:30:36+02:00",
                             "eventType": "Meal Bolus", "insulin": 1.4, "key600": "BOLUS8165B83F",
                             "notes": "carb 0g 0.0U, {75~100} 1.3U, iob 1.0 -1.0U (12g/u, isf 125/u)", "carbs": None},
                            {"_id": "5d30d44ca7775b341add6d31", "created_at": "2019-07-18T21:30:03+02:00",
                             "eventType": "BG Check", "glucose": 267, "glucoseType": "Finger", "key600": "BG8165B81E",
                             "units": "mg/dl", "carbs": None, "insulin": None}], status=200)
        response = requests.get("https://benc.com/api/v1/treatments")
        process_nightscouts_api_response(response)
        self.assertEqual(InfusionChanged.objects.get(id=1), InfusionChanged(date="2019-07-21T20:30:40+02:00", id=1))
        self.assertEqual(SensorChanged.objects.get(id=1), SensorChanged(date="2019-07-21T18:58:52+02:00", id=1))

    @override_settings(SENSOR_ALERT_FREQUENCY=24)
    def test_calculate_sensor(self):
        date = datetime.now(timezone.utc) - timedelta(hours=10)
        sensor_remains = calculate_sensor(date)
        self.assertEqual(sensor_remains, timedelta(hours=14))

    @override_settings(INFUSION_SET_ALERT_FREQUENCY=48)
    def test_calculate_infusion(self):
        date = datetime.now(timezone.utc) - timedelta(hours=10)
        sensor_remains = calculate_infusion(date)
        self.assertEqual(sensor_remains, timedelta(hours=38))

    def test_get_trigger_model(self):
        model = get_trigger_model()
        self.assertEqual(model.time, time(16))
        TriggerTime.objects.update(id=1, time=time(18))
        model = get_trigger_model()
        self.assertEqual(model.time, time(18))

    def test_not_today(self):
        self.assertTrue(not_today())
        LastTriggerSet.objects.update_or_create(id=1, defaults={"date": datetime.now().date()})
        self.assertFalse(not_today())

    def test_update_last_trigger_set(self):
        update_last_triggerset()
        self.assertFalse(not_today())  # tested already above
        LastTriggerSet.objects.update_or_create(id=1, defaults={"date": datetime.now().date() - timedelta(days=7)})
        self.assertTrue(not_today())
        update_last_triggerset()
        self.assertFalse(not_today())

    @override_settings(LANGUAGE_CODE="en")
    def test_get_sms_txt_sensor(self):
        text = get_sms_txt_sensor(timedelta(days=1, hours=2))
        self.assertEqual(text, "\n\n Your CGM sensor should be changed in 1 days and 2 hours.")
        text = get_sms_txt_sensor(timedelta(days=-1, hours=2))
        self.assertEqual(text, "\n\n Your CGM sensor change has already passed")

    @override_settings(LANGUAGE_CODE="en")
    def test_get_sms_txt_infusion_set(self):
        text = get_sms_txt_infusion_set(timedelta(days=1, hours=2))
        self.assertEqual(text, ".\n\n Your infusion set should be changed in 1 days and 2 hours.")
        text = get_sms_txt_infusion_set(timedelta(days=-1, hours=2))
        self.assertEqual(text, ".\n\n Your infusion set change has already passed")


